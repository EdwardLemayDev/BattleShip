var Rt=Object.defineProperty;var Et=r=>{throw TypeError(r)};var Zt=(r,e,t)=>e in r?Rt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>Zt(r,typeof e!="symbol"?e+"":e,t),ft=(r,e,t)=>e.has(r)||Et("Cannot "+t);var i=(r,e,t)=>(ft(r,e,"read from private field"),t?t.call(r):e.get(r)),c=(r,e,t)=>e.has(r)?Et("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),H=(r,e,t,s)=>(ft(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),y=(r,e,t)=>(ft(r,e,"access private method"),t);var dt=(r,e,t,s)=>({set _(n){H(r,e,n,t)},get _(){return i(r,e,s)}});import{v as Gt,E as Ht,A as jt,a0 as Bt,as as Ft,q as qt,C as Nt,at as Ut,au as Wt,av as $t,ar as m,aw as zt,j as Jt,d as o,c as u,aq as Kt,l as xt,ax as Qt,p as Tt}from"./runtime.BrnUzT_c.js";import{p as f}from"./proxy.DdhnCG31.js";function ue(r,e,...t){var s=r,n=Bt,l;Gt(()=>{n!==(n=e())&&(l&&(Ft(l),l=null),l=jt(()=>n(s,...t)))},Ht),qt&&(s=Nt)}function yt(r,e){function t(...n){return Ut(r,e(...n))}function s(){if(Wt(r))return $t(r);throw new Error(`Context "${r.toString()} is undefined"`)}return[t,s]}var j,Q,D,R,O,mt,gt;class Vt{constructor(e,t){c(this,O);c(this,j,m());c(this,Q);c(this,D,0);c(this,R,null);i(this,j).v=f(e),H(this,Q,t)}get current(){return zt()?Jt(()=>(dt(this,D)._++,i(this,D)===1&&y(this,O,mt).call(this,!0),()=>{Kt().then(()=>{dt(this,D)._--,i(this,D)===0&&y(this,O,gt).call(this)})})):i(this,D)===0&&(y(this,O,mt).call(this,!1),y(this,O,gt).call(this)),o(i(this,j))}}j=new WeakMap,Q=new WeakMap,D=new WeakMap,R=new WeakMap,O=new WeakSet,mt=function(e){H(this,R,i(this,Q).call(this,t=>{u(i(this,j),f(t))},e)??null)},gt=function(){i(this,R)!==null&&(i(this,R).call(this),H(this,R,null))};new Vt(null,(r,e)=>{function t(){r(document.activeElement)}if(t(),!!e)return document.addEventListener("focusin",t),document.addEventListener("focusout",t),()=>{document.removeEventListener("focusin",t),document.removeEventListener("focusout",t)}});function bt(r,e=250){let t=m(null);function s(...n){if(o(t))o(t).timeout&&clearTimeout(o(t).timeout);else{let l,p,w=new Promise((Mt,Ot)=>{l=Mt,p=Ot});u(t,f({timeout:null,promise:w,resolve:l,reject:p}))}return o(t).timeout=setTimeout(async()=>{if(!o(t))return;const l=o(t);u(t,null);try{l.resolve(await r.apply(this,n))}catch(p){l.reject(p)}},typeof e=="function"?e():e),o(t).promise}return s.cancel=async()=>{(!o(t)||o(t).timeout===null)&&(await new Promise(n=>setTimeout(n,0)),!o(t)||o(t).timeout===null)||(clearTimeout(o(t).timeout),o(t).reject("Cancelled"),u(t,null))},Object.defineProperty(s,"pending",{enumerable:!0,get(){var n;return!!((n=o(t))!=null&&n.timeout)}}),s}function Xt(r){return!!r&&typeof r=="object"&&"to"in r&&"from"in r&&"event"in r&&"args"in r}var k,Z,P,It,J;class Ct{constructor(e,t){c(this,P);c(this,k,m());g(this,"states");c(this,Z,{});i(this,k).v=f(e),this.states=t,y(this,P,J).call(this,"_enter",{from:null,to:e,event:null,args:[]})}send(e,...t){const s=y(this,P,J).call(this,e,...t);return s&&s!==o(i(this,k))&&y(this,P,It).call(this,s,e,t),o(i(this,k))}async debounce(e=500,t,...s){return i(this,Z)[t]&&clearTimeout(i(this,Z)[t]),new Promise(n=>{i(this,Z)[t]=setTimeout(()=>{delete i(this,Z)[t],n(this.send(t,...s))},e)})}get current(){return o(i(this,k))}}k=new WeakMap,Z=new WeakMap,P=new WeakSet,It=function(e,t,s){const n={from:o(i(this,k)),to:e,event:t,args:s};y(this,P,J).call(this,"_exit",n),u(i(this,k),f(e)),y(this,P,J).call(this,"_enter",n)},J=function(e,...t){var n,l;const s=((n=this.states[o(i(this,k))])==null?void 0:n[e])??((l=this.states["*"])==null?void 0:l[e]);if(s instanceof Function)if(e==="_enter"||e==="_exit")Xt(t[0])?s(t[0]):console.warn("Invalid metadata passed to lifecycle function of the FSM.");else return s(...t);else{if(typeof s=="string")return s;e!=="_enter"&&e!=="_exit"&&console.warn("No action defined for event",e,"in state",o(i(this,k)))}};const[fe,de]=yt(Symbol(),(r,e)=>{const t=()=>(e.send("new"),"game"),s=new Ct("loading",{loading:{loaded:"intro"},intro:{done:"menu"},menu:{lobby_new:t},game:{quit:()=>(e.send("reset"),"menu")}});return{get state(){return s.current},loaded:()=>{s.send("loaded")},introDone:()=>{s.send("done")},quitGame:()=>{s.send("quit")},createLobby:()=>{s.send("lobby_new")}}});function Pt(r,e){try{localStorage.setItem(r,e)}catch{}}function At(r){try{return localStorage.getItem(r)}catch{return null}}const[pe,me]=yt(Symbol(),()=>{});var _;class Dt{constructor(e,t){c(this,_);H(this,_,new Ct("__new__",{__new__:{__init__:e},...t}))}get state(){return i(this,_).current}init(){this.state==="__new__"&&i(this,_).send("__init__")}canTrigger(e){return e in i(this,_).states[this.state]||i(this,_).states["*"]!==void 0&&e in i(this,_).states["*"]}send(e,...t){return xt(()=>i(this,_).send(e,...t))}debounce(e,t,...s){return xt(()=>i(this,_).debounce(e,t,...s))}}_=new WeakMap;function Yt(r){return{all:r=r||new Map,on:function(e,t){var s=r.get(e);s?s.push(t):r.set(e,[t])},off:function(e,t){var s=r.get(e);s&&(t?s.splice(s.indexOf(t)>>>0,1):r.set(e,[]))},emit:function(e,t){var s=r.get(e);s&&s.slice().map(function(n){n(t)}),(s=r.get("*"))&&s.slice().map(function(n){n(e,t)})}}}function te(){const r=Yt(),e={1:[],2:[],mode:[]};return Object.assign(r,{context:t=>({on:(...s)=>{r.on(...s),e[t].push(s)},emit(...s){setTimeout(()=>r.emit(...s))}}),reset:t=>{e[t].forEach(s=>r.off(...s)),e[t]=[]}})}function C(r,e){return r=Math.ceil(r),e=Math.floor(e),Math.floor(Math.random()*(e-r+1))+r}var V;class ee{constructor(e){g(this,"name","Bonus");c(this,V,m(1));e.on("firstTurn",()=>{this.turn=C(1,2),e.emit("play",this.turn)}),e.on("report",({result:t})=>{t==="miss"&&(this.turn=this.turn===1?2:1)}),e.on("nextTurn",()=>{e.emit("play",this.turn)})}get turn(){return o(i(this,V))}set turn(e){u(i(this,V),f(e))}}V=new WeakMap;var X;class ie{constructor(e){g(this,"name","Classic");c(this,X,m(1));e.on("firstTurn",()=>{this.turn=C(1,2),e.emit("play",this.turn)}),e.on("nextTurn",()=>{this.turn=this.turn===1?2:1,e.emit("play",this.turn)})}get turn(){return o(i(this,X))}set turn(e){u(i(this,X),f(e))}}X=new WeakMap;var Y,tt,B;class se{constructor(e){g(this,"name","Salvo");c(this,Y,m(1));c(this,tt,m(f([5,5])));c(this,B,m(0));e.on("firstTurn",()=>{this.turn=C(1,2),e.emit("play",this.turn)}),e.on("nextTurn",()=>{Qt(i(this,B)),o(i(this,B))===o(i(this,tt))[this.turn-1]&&(u(i(this,B),0),this.turn=this.turn===1?2:1),e.emit("play",this.turn)}),e.on("report",({playerId:t,result:s})=>{s==="sink"&&o(i(this,tt))[t-1]--})}get turn(){return o(i(this,Y))}set turn(e){u(i(this,Y),f(e))}}Y=new WeakMap,tt=new WeakMap,B=new WeakMap;var A;(r=>{var p,w,K,St,q,N,U,W,G,ot,lt,$,z;class e{constructor(){g(this,"grid",new t);g(this,"fleet",new n);c(this,p,m("h"))}get selectDirection(){return o(i(this,p))}set selectDirection(a){u(i(this,p),f(a))}selectShip(a){this.fleet.selectShip(a),this.grid.removeShip(a),this.fleet.ships[a].placed=!1}placeShip(a,h){if(this.fleet.selected===void 0)return!1;if(this.grid.placeShip(a,h,this.selectDirection,this.fleet.selected)){this.fleet.selected.placed=!0,this.clearPreview();for(let d of this.fleet.ships)if(!d.placed)return this.fleet.selectShip(d.id),!0;return this.fleet.selectShip(null),!0}return!1}previewShip(a,h){this.fleet.selected!==void 0&&(this.grid.clearPreview(),this.grid.previewShip(a,h,this.selectDirection,this.fleet.selected))}clearPreview(){this.grid.clearPreview()}validateAttack(a,h,d){this.grid.validateAttack(a,h,d)}reportAttack(a,h){const{id:d,section:v}=this.grid.reportAttack(a,h)??{};return d===void 0||v===void 0?"miss":this.fleet.reportAttack(d,v)}flipSelectDirection(){this.selectDirection=this.selectDirection==="h"?"v":"h"}}p=new WeakMap,r.Logic=e;const x=class x{constructor(){c(this,w);g(this,"tiles",[]);for(let a=0;a<x.SIZE;(a+=1)-1)for(let h=0;h<x.SIZE;(h+=1)-1)this.tiles[a+h*x.SIZE]=new s(a,h)}static clampedPositions(a,h,d,v){const T=d==="h",L=[{x:a,y:h}];let b=0;for(;L.length<v;){b+=1;const wt=T?a+b:a,Lt=T?h:h+b;if(wt<x.SIZE&&Lt<x.SIZE&&(L.push({x:wt,y:Lt}),L.length===v))break;const kt=T?a-b:a,_t=T?h:h-b;kt>=0&&_t>=0&&L.unshift({x:kt,y:_t})}return L}previewShip(a,h,d,v){y(this,w,St).call(this,a,h,d,v.length).forEach((L,b)=>{L.previewShipSegment={direction:d,id:v.id,section:b}})}clearPreview(){for(let a of this.tiles)a.previewShipSegment!==null&&(a.previewShipSegment=null)}placeShip(a,h,d,v){const T=y(this,w,St).call(this,a,h,d,v.length);for(let L of T)if(L.placedShipSegment!==null)return!1;return T.forEach((L,b)=>{L.placedShipSegment={direction:d,id:v.id,section:b}}),!0}removeShip(a){for(let h of this.tiles)h.placedShipSegment===null||h.placedShipSegment.id!==a||(h.placedShipSegment=null)}canAttack(a,h){return y(this,w,K).call(this,a,h).attackHit===null}reportAttack(a,h){const d=y(this,w,K).call(this,a,h);return d.reported=!0,d.placedShipSegment}validateAttack(a,h,d){y(this,w,K).call(this,a,h).attackHit=d!=="miss"}};w=new WeakSet,K=function(a,h){return this.tiles[a+h*x.SIZE]},St=function(a,h,d,v){return x.clampedPositions(a,h,d,v).map(({x:T,y:L})=>y(this,w,K).call(this,T,L))},g(x,"SIZE",10);let t=x;r.Grid=t;class s{constructor(a,h){g(this,"tag");g(this,"x");g(this,"y");c(this,q,m(null));c(this,N,m(null));c(this,U,m(!1));c(this,W,m(null));this.tag=`${String.fromCharCode(h+65)}${a+1}`,this.x=a,this.y=h}get placedShipSegment(){return o(i(this,q))}set placedShipSegment(a){u(i(this,q),a)}get previewShipSegment(){return o(i(this,N))}set previewShipSegment(a){u(i(this,N),a)}get reported(){return o(i(this,U))}set reported(a){u(i(this,U),f(a))}get attackHit(){return o(i(this,W))}set attackHit(a){u(i(this,W),f(a))}}q=new WeakMap,N=new WeakMap,U=new WeakMap,W=new WeakMap,r.Tile=s;const ht=class ht{constructor(){c(this,G,m(null));g(this,"ships",[]);c(this,ot,Tt(()=>{if(o(i(this,G))!==null)return this.ships[o(i(this,G))]}));c(this,lt,Tt(()=>{for(let a of this.ships)if(!a.placed)return!1;return!0}));this.ships=ht.SHIPS.map(([a,h],d)=>new l(a,h,d))}get selected(){return o(i(this,ot))}get ready(){return o(i(this,lt))}selectShip(a){u(i(this,G),f(a))}reportAttack(a,h){const d=this.ships[a];d.hits[h]=!0;for(let v of d.hits)if(!v)return"hit";return"sink"}};G=new WeakMap,ot=new WeakMap,lt=new WeakMap,g(ht,"SHIPS",[["Carrier",5],["Battleship",4],["Destroyer",3],["Submarine",3],["Cruiser",2]]);let n=ht;r.Fleet=n;class l{constructor(a,h,d){g(this,"name");g(this,"length");g(this,"id");c(this,$,m(f([])));c(this,z,m(!1));this.name=a,this.length=h,this.id=d,this.hits=new Array(h).fill(!1)}get hits(){return o(i(this,$))}set hits(a){u(i(this,$),f(a))}get placed(){return o(i(this,z))}set placed(a){u(i(this,z),f(a))}}$=new WeakMap,z=new WeakMap,r.Ship=l})(A||(A={}));var M,et;class re{constructor(e,t){g(this,"id");g(this,"name","Bot - Easy");c(this,M,new A.Logic);c(this,et,m(5));this.id=e,t.on("start",()=>{let s=0,n=0,l="h";for(let p of i(this,M).fleet.ships)do s=C(0,A.Grid.SIZE-1),n=C(0,A.Grid.SIZE-1),l=C(0,1)===0?"h":"v";while(!i(this,M).grid.placeShip(s,n,l,p));t.emit("ready",e)}),t.on("play",s=>{if(s!==e)return;let n=0,l=0;do n=C(0,A.Grid.SIZE-1),l=C(0,A.Grid.SIZE-1);while(!i(this,M).grid.canAttack(n,l));setTimeout(()=>t.emit("shoot",{playerId:e,x:n,y:l}),C(500,1e3))}),t.on("shoot",({playerId:s,x:n,y:l})=>{if(s===e)return;const p=i(this,M).reportAttack(n,l);p==="sink"&&this.lives--,t.emit("report",{playerId:e,x:n,y:l,result:p}),t.emit("ready",e)}),t.on("report",({playerId:s,x:n,y:l,result:p})=>{s!==e&&(i(this,M).validateAttack(n,l,p),t.emit("ready",e))})}get lives(){return o(i(this,et))}set lives(e){u(i(this,et),f(e))}}M=new WeakMap,et=new WeakMap;const pt=Symbol("NULL RETURN");function ne(r,e){let t=pt;return(...s)=>(t!==pt||(t=r(...s),setTimeout(()=>{t=pt},e)),t)}var S,I,it,st,rt,ct;class ae extends Dt{constructor(t,s){super("idle",{idle:{start:()=>"setup"},setup:{_enter:()=>{i(this,S).selectShip(0)},ready:()=>{if(i(this,S).fleet.ready)return"waiting"},select:n=>{i(this,S).selectShip(n)},preview:(n,l)=>{i(this,S).previewShip(n,l)},clearPreview:()=>{i(this,S).clearPreview()},place:(n,l)=>{i(this,S).placeShip(n,l)}},waiting:{_enter:()=>{s.emit("ready",t)},attack:()=>"attacking",defend:()=>"defending",gameOver:()=>"gameOver"},attacking:{shoot:(n,l)=>(s.emit("shoot",{playerId:t,x:n,y:l}),"validating")},validating:{validate:(n,l,p)=>(i(this,S).validateAttack(n,l,p),p==="sink"&&this.enemyLives--,"waiting")},defending:{report:(n,l)=>{const p=i(this,S).reportAttack(n,l);return p==="sink"&&this.lives--,s.emit("report",{playerId:t,x:n,y:l,result:p}),"waiting"}},gameOver:{}});g(this,"id");c(this,S,new A.Logic);c(this,I,m(null));c(this,it,m(5));c(this,st,m(!1));c(this,rt,m(5));c(this,ct,bt(t=>{Pt("player_name",t)},500));g(this,"flipSelectDirection",ne(()=>{i(this,S).flipSelectDirection()},250));this.id=t,s.on("start",()=>{this.send("start")}),s.on("play",n=>{n===t?this.send("attack"):this.send("defend")}),s.on("shoot",({playerId:n,x:l,y:p})=>{n!==t&&this.send("report",l,p)}),s.on("report",({playerId:n,x:l,y:p,result:w})=>{n!==t&&this.send("validate",l,p,w)}),s.on("gameOver",n=>{this.gameWon=n===t,this.send("gameOver")}),this.init()}get lives(){return o(i(this,it))}set lives(t){u(i(this,it),f(t))}get gameWon(){return o(i(this,st))}set gameWon(t){u(i(this,st),f(t))}get enemyLives(){return o(i(this,rt))}set enemyLives(t){u(i(this,rt),f(t))}get name(){return o(i(this,I))!==null?o(i(this,I)):(u(i(this,I),f(At("player_name")??"")),o(i(this,I)))}set name(t){t!==o(i(this,I))&&(u(i(this,I),f(t)),i(this,ct).call(this,t))}get ships(){return i(this,S).fleet.ships}get selectedShip(){return i(this,S).fleet.selected}get fleetReady(){return i(this,S).fleet.ready}get tiles(){return i(this,S).grid.tiles}get selectDirection(){return i(this,S).selectDirection}}S=new WeakMap,I=new WeakMap,it=new WeakMap,st=new WeakMap,rt=new WeakMap,ct=new WeakMap;const[ge,Se]=yt(Symbol("GameLogic Context"),()=>new oe);var nt,F,E,at,ut;class oe extends Dt{constructor(){super("idle",{idle:{_enter:()=>{this.role=null,this.setPlayer(1,null),this.setPlayer(2,null),this.setMode(null)},new:()=>(this.role="host",this.setPlayer(1,"Local"),this.setPlayer(2,"Easy"),this.setMode(At("game_mode")??"Classic"),"lobby")},lobby:{start:()=>(this.global.emit("start"),"setup")},setup:{ready:()=>"playing"},playing:{_enter:()=>{this.global.emit("firstTurn")},ready:()=>{for(let t of this.players)if(t===null||o(i(this,E))===null){this.send("reset");return}else if(t.lives<=0)return this.global.emit("gameOver",o(i(this,E)).turn),"gameOver";this.global.emit("nextTurn")}},gameOver:{},"*":{reset:()=>"idle"}});g(this,"global",te());c(this,nt,m(f([null,null])));c(this,F,m(f([!1,!1])));c(this,E,m(null));c(this,at,m(null));c(this,ut,bt(t=>{Pt("game_mode",t)},500));this.global.on("ready",t=>{o(i(this,F))[t-1]=!0;for(let s of o(i(this,F)))if(!s)return;u(i(this,F),f([!1,!1])),this.send("ready")}),this.init()}get players(){return o(i(this,nt))}set players(t){u(i(this,nt),f(t))}get role(){return o(i(this,at))}set role(t){u(i(this,at),f(t))}get turn(){var t;return((t=o(i(this,E)))==null?void 0:t.turn)??null}get mode(){var t;return((t=o(i(this,E)))==null?void 0:t.name)??null}set mode(t){this.setMode(t)}getPlayer(t){return this.players[t-1]}setPlayer(t,s){const n=t-1;this.global.reset(t);const l=this.global.context(t);switch(s){case"Local":{this.players[n]=new ae(t,l);break}case"Easy":{this.players[n]=new re(t,l);break}default:this.players[n]=null}}setMode(t){t&&i(this,ut).call(this,t),this.global.reset("mode");const s=this.global.context("mode");switch(t){case"Classic":{u(i(this,E),f(new ie(s)));break}case"Salvo":{u(i(this,E),f(new se(s)));break}case"Bonus":{u(i(this,E),f(new ee(s)));break}default:u(i(this,E),null)}}}nt=new WeakMap,F=new WeakMap,E=new WeakMap,at=new WeakMap,ut=new WeakMap;export{Ct as F,ae as L,pe as a,ge as b,ue as c,de as d,me as e,ne as f,fe as s,Se as u};
